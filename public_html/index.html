<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Finance tracker</title>
    <script src="js/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <script>
        $(document).ready(function () {
            let url = "view/user/login.html";
            if (localStorage.getItem("id") !== null) {
                url = "view/main.html";
                $.get("view/menu.html", function (data) {
                    $("#menu").html(data);
                });
            }

            $.get(url, function (data) {
                $("#container").html(data);
            });

            $(document).on("click", '.loader', function(event) {
                event.preventDefault();
                let href = 'view/' + $(this).attr("href");
                $.get(href, function (data) {
                    let cont = $("#container");
                    cont.empty();
                    cont.html(data);
                });
            });
            $(document).on("click", ':submit', function (e) {
                e.preventDefault();
                let form = $(this).closest("form");
                let action = form.attr("action");
                let data = form.serialize() + '&' + $(this).attr("name");
                $.post(action, data, function (data) {
                    let response = JSON.parse(data);
                    if (response.status === true) {
                        if (response.target === 'register') {
                            alert('Registration succesfull!');
                            $.get('view/user/login.html', function (data) {
                                $("#container").html(data);
                            });
                        } else if(response.target === 'login') {
                            alert("Login succesfull!");
                            localStorage.setItem("name", response.full_name);
                            localStorage.setItem("id", response.id);
                            let url = "view/main.html";
                            $.get(url, function (data) {
                                $("#container").html(data);
                            });
                        } else if(response.target === 'addaccount') {
                            alert('Account added succesfully!');
                        }
                    }
                });
            })
        });
    </script>
</head>
<body>
<div id="menu"></div>
<div id="container"></div>
</body>
</html>